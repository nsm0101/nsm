<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CloseDose – Pediatric Medication Dosing Calculator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    :root {
      --teal-400: #24a687;
      --teal-500: #3a9e92;
      --teal-600: #123a37;
      --ink-900: #0f2c2a;
      --bg: #f5f9f9;
      --white: #fff;
      --radius-lg: 18px;
      --radius-pill: 30px;
      --black: #111;
      --light-accent: #e0f1ee;
      --shadow-main: 0 3px 0 #222;
      --shadow-card: 0 6px 0 #222;
      --shadow-btn: 0 2px 0 #111;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Nunito", sans-serif;
      background: var(--bg) url("images/light-bg.png") repeat;
      background-size: 360px auto;
      color: var(--ink-900);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Menu button - top right */
    .menu-btn {
      position: absolute;
      top: 24px;
      right: 24px;
      z-index: 100;
      background: #fff;
      color: var(--ink-900);
      border: 3px solid var(--ink-900);
      border-radius: 50px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 18px;
      padding: 10px 18px 10px 18px;
      box-shadow: var(--shadow-btn);
      display: flex;
      align-items: center;
      gap: 9px;
      cursor: pointer;
      transition: background .12s, color .12s, box-shadow .12s, border .12s;
      user-select: none;
    }
    .menu-btn .label {
      display: inline-block;
      transition: opacity .18s, transform .18s;
    }
    .menu-btn .hamburger {
      display: inline-block;
      width: 32px;
      height: 32px;
      position: relative;
    }
    .menu-btn .hamburger span {
      display: block;
      position: absolute;
      left: 5px;
      right: 5px;
      height: 4px;
      background: var(--ink-900);
      border-radius: 2.2px;
      transition: background .15s;
    }
    .menu-btn .hamburger span:nth-child(1) { top: 7px; }
    .menu-btn .hamburger span:nth-child(2) { top: 14px; }
    .menu-btn .hamburger span:nth-child(3) { top: 21px; }

    @media (max-width: 600px) {
      .menu-btn {
        padding: 10px;
        border-radius: 999px;
        font-size: 0;
        width: 48px;
        height: 48px;
        justify-content: center;
      }
      .menu-btn .label {
        display: none;
      }
      .menu-btn .hamburger {
        width: 28px;
        height: 28px;
      }
    }

    /* Overlay menu */
    .menu-overlay {
      position: fixed;
      inset: 0;
      z-index: 99;
      background: rgba(245,249,249,0.96);
      backdrop-filter: blur(3px) saturate(1.02);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .22s;
    }
    .menu-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .menu-panel {
      width: min(400px, 92vw);
      background: #fff;
      border: 3px solid var(--ink-900);
      border-radius: var(--radius-lg);
      box-shadow: 0 6px 0 var(--ink-900);
      padding: 32px 26px 20px 26px;
      transform: translateY(8px);
      transition: transform .2s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .menu-overlay.open .menu-panel {
      transform: translateY(0);
    }
    .menu-links {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 20px 0 20px 0;
      width: 100%;
    }
    .menu-links a {
      text-decoration: none;
      color: var(--ink-900);
      font-weight: 900;
      letter-spacing: .04em;
      text-align: center;
      font-size: 1.4rem;
      padding: 10px 4px;
      border-radius: 10px;
      transition: background .12s, color .12s;
    }
    .menu-links a[aria-disabled="true"] {
      color: #bbb;
      pointer-events: none;
    }
    .close-menu {
      margin: 6px auto 0;
      font-size: 1rem;
      padding: 10px 18px;
      text-transform: uppercase;
      border: 2px solid var(--ink-900);
      border-radius: 30px;
      background: var(--teal-400);
      color: #fff;
      font-weight: 900;
      letter-spacing: .07em;
      cursor: pointer;
      box-shadow: var(--shadow-btn);
    }
    .close-menu:active { background: var(--teal-600);}
    .sr-only { position: absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0 }

    /* Centered main card with accent bars */
    .main-wrap {
      margin: 0 auto;
      padding: 30px 0 0 0;
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 85vh;
      width: 100vw;
    }
    .card-stack {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
      max-width: 520px;
      width: 100%;
      margin-top: 30px;
    }
    .accent-bar { height: 13px; border-radius: 9px 9px 0 0; background: var(--teal-400); margin-bottom: 2px;}
    .accent-bar:nth-child(2) { background: var(--teal-500); margin-left: 14px; margin-right: 14px;}
    .accent-bar:nth-child(3) { background: var(--ink-900); margin-left: 24px; margin-right: 24px;}

    .main-card {
      background: var(--white);
      border: 3px solid var(--black);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-card);
      padding: 38px 32px 28px 32px;
      z-index: 2;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Logo row */
    .logo-row {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 18px;
      margin-bottom: 8px;
      justify-content: flex-start;
    }
    .logo-row img.logo-lg {
      width: 120px;
      height: auto;
    }
    .logo-row img.wordmark {
      height: 64px;
      width: auto;
      display: block;
    }

    /* Section cards */
    .form-section {
      background: var(--light-accent);
      border: 2px solid var(--black);
      border-radius: 12px;
      margin: 16px 0;
      padding: 18px 18px 14px 18px;
      width: 100%;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .form-section label,
    .form-section .section-title {
      font-weight: 900;
      text-transform: uppercase;
      font-size: 1.1rem;
      margin-bottom: 8px;
      letter-spacing: 0.03em;
      color: var(--ink-900);
    }

    /* Pills/buttons */
    .pill-group {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin: 0 0 0 0;
      width: 100%;
    }
    .pill {
      appearance: none;
      border: 3px solid var(--black);
      background: var(--teal-400);
      color: var(--white);
      font-weight: 900;
      font-size: 1.2rem;
      letter-spacing: 0.04em;
      border-radius: var(--radius-pill);
      padding: 22px 32px;
      box-shadow: var(--shadow-btn);
      cursor: pointer;
      text-transform: uppercase;
      min-width: 120px;
      transition: background .12s, transform .05s, box-shadow .12s, filter .12s;
    }
    .pill:focus-visible { outline: 4px dashed var(--ink-900); outline-offset: 2px; }
    .pill[aria-pressed="true"], .pill:active {
      background: var(--teal-600);
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(0,0,0,.20);
      filter: saturate(1.10);
    }
    .pill[disabled] { opacity: 0.4; pointer-events: none; }

    .pill .pill-label-main {
      display: block;
      font-size: 1.15em;
      font-weight: 900;
      line-height: 1.2;
      margin-bottom: 2px;
    }
    .pill .pill-label-sub {
      display: block;
      font-size: .85em;
      font-weight: 700;
      letter-spacing: 0.01em;
      margin-top: 2px;
    }

    /* Weight input row */
    .weight-row {
      display: flex;
      align-items: flex-end;
      gap: 18px;
      margin-top: 10px;
      width: 100%;
    }
    .weight-box {
      border: 3px dashed var(--black);
      border-radius: 18px;
      padding: 18px 14px 6px 14px;
      min-width: 200px;
      background: #fff;
      display: flex;
      align-items: flex-end;
      flex-direction: column;
      position: relative;
      margin-right: 10px;
      flex: 1 1 200px;
      box-sizing: border-box;
    }
    #weight {
      appearance: textfield;
      background: transparent;
      border: none;
      border-bottom: 3px solid var(--teal-400);
      font-size: 1.5rem;
      font-weight: 900;
      letter-spacing: .08em;
      color: var(--ink-900);
      width: 100%;
      max-width: 180px;
      margin: 0;
      outline: none;
      padding: 0 0 2px 0;
      box-sizing: border-box;
      text-align: left;
    }
    #weight::placeholder {
      color: #4c7572;
      text-transform: uppercase;
      font-weight: 700;
      opacity: 1;
      letter-spacing: 0.06em;
      font-size: 1.1em;
    }
    /* Units */
    .unit-toggle {
      display: flex;
      gap: 12px;
    }
    /* Calculate button */
    .cta {
      margin-top: 32px;
      display: flex;
      justify-content: center;
      width: 100%;
    }
    .cta button {
      appearance: none;
      border: 3px solid var(--black);
      background: var(--teal-400);
      color: var(--white);
      font-weight: 900;
      letter-spacing: .18em;
      text-transform: uppercase;
      padding: 20px 0;
      border-radius: var(--radius-pill);
      font-size: 1.35rem;
      box-shadow: var(--shadow-main);
      cursor: pointer;
      min-width: 320px;
      transition: background .12s, transform .05s, box-shadow .12s;
    }
    .cta button:active, .cta button[aria-pressed="true"] {
      background: var(--teal-600);
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(0,0,0,.20);
    }
    .cta button[disabled] { opacity: 0.4; pointer-events: none; }

    /* Results panel */
    #results {
      margin-top: 1.4rem;
      width: 100%;
      text-align: center;
      color: var(--ink-900);
      font-size: 1.1rem;
    }

    /* Footer */
    footer.disclaimer {
      margin: 0;
      background: #111;
      color: #fff;
      font-size: 0.94rem;
      line-height: 1.4;
      padding: 14px 24px 8px 24px;
      text-align: center;
      border-top: 2px solid #222;
      font-weight: 400;
    }
    footer .disclaimer-note {
      font-size: 0.95em;
      letter-spacing: 0.01em;
      color: #ecd;
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }
    @media (max-width: 600px) {
      .main-card, .main-wrap { padding: 0 !important; }
      .main-card { padding: 18px 4vw 16px 4vw; }
      .logo-row img.logo-lg { width: 80px;}
      .logo-row img.wordmark { height: 38px;}
      .card-stack { max-width: 99vw;}
    }
  </style>
</head>
<body>
  <!-- Menu Button -->
  <button class="menu-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="menuOverlay" aria-label="Open menu">
    <span class="label">Menu</span>
    <span class="hamburger" aria-hidden="true">
      <span></span><span></span><span></span>
    </span>
  </button>
  <!-- Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay" hidden>
    <div class="menu-panel" role="dialog" aria-modal="true" aria-labelledby="menuHeading">
      <h2 id="menuHeading" class="sr-only">Site menu</h2>
      <div class="menu-links">
        <a href="index.html">Calculator</a>
        <a href="medication-guides.html">Medication Guides</a>
        <a href="#" aria-disabled="true">Translate</a>
        <a href="#" aria-disabled="true">Donate!</a>
      </div>
      <button class="close-menu" type="button">Close</button>
    </div>
  </div>
  <div class="main-wrap">
    <div class="card-stack">
      <div class="accent-bar"></div>
      <div class="accent-bar"></div>
      <div class="accent-bar"></div>
      <main class="main-card" role="main">
        <div class="logo-row">
          <img class="logo-lg" src="images/logo-hex2tone.png" alt="CloseDose logo">
          <img class="wordmark" src="images/name.png" alt="CLOSEDOSE">
        </div>
        <form>
          <!-- Patient Age -->
          <section class="form-section age-group">
            <span class="section-title">Patient Age:</span>
            <div class="pill-group" role="group" aria-label="Age groups" id="ageGroup">
              <button class="pill" type="button" aria-pressed="false" data-age="0-2">
                <span class="pill-label-main">0-2</span>
                <span class="pill-label-sub">MONTHS</span>
              </button>
              <button class="pill" type="button" aria-pressed="false" data-age="2-6">
                <span class="pill-label-main">2-6</span>
                <span class="pill-label-sub">MONTHS</span>
              </button>
              <button class="pill" type="button" aria-pressed="false" data-age="6+">
                <span class="pill-label-main">6+</span>
                <span class="pill-label-sub">MONTHS</span>
              </button>
            </div>
            <div id="message" role="alert" aria-live="polite" hidden></div>
          </section>
          <!-- Patient Weight -->
          <section class="form-section">
            <span class="section-title">Patient Weight:</span>
            <div class="weight-row">
              <div class="weight-box">
                <label for="weight" class="sr-only">Enter weight</label>
                <input id="weight" type="number" inputmode="decimal" placeholder="ENTER WEIGHT" disabled />
              </div>
              <div class="unit-toggle" role="group" aria-label="Units" id="unitGroup">
                <button class="pill" type="button" aria-pressed="false" data-unit="lbs" disabled>lbs</button>
                <button class="pill" type="button" aria-pressed="false" data-unit="kg" disabled>kg</button>
              </div>
            </div>
          </section>
          <!-- Calculate Button -->
          <div class="cta">
            <button id="calculate" type="button" aria-pressed="false" disabled>Calculate</button>
          </div>
        </form>
        <div id="results" aria-live="polite"></div>
        <div id="liveRegion" class="sr-only" aria-live="polite"></div>
      </main>
    </div>
  </div>
  <footer class="disclaimer">
    <span class="disclaimer-note">
      <strong>Disclaimer:</strong> This tool is for educational purposes only and is not a substitute for professional medical advice. Always confirm dosing with your pediatrician or pharmacist before administering medication.
    </span>
    Updated 9.21.2025 • Nickolas Mancini, MD, MBA
  </footer>
  <script>
    // --- Exclusive toggle helpers ---
    function initExclusiveGroup(containerId, pressedAttr, onChange){
      const group = document.getElementById(containerId);
      group.addEventListener('click', (e)=>{
        const btn = e.target.closest('button.pill');
        if(!btn) return;
        [...group.querySelectorAll('button.pill')].forEach(b=> b.setAttribute('aria-pressed', String(b===btn)));
        if(onChange) onChange(btn);
      });
    }

    // --- Menu overlay ---
    (function(){
      const menuBtn = document.querySelector('.menu-btn');
      const overlay = document.getElementById('menuOverlay');
      function openMenu(){ overlay.hidden=false; overlay.classList.add('open'); menuBtn.setAttribute('aria-expanded','true'); menuBtn.setAttribute('aria-label','Close menu'); overlay.querySelector('.close-menu').focus(); }
      function closeMenu(){ overlay.classList.remove('open'); overlay.hidden=true; menuBtn.setAttribute('aria-expanded','false'); menuBtn.setAttribute('aria-label','Open menu'); menuBtn.focus(); }
      menuBtn.addEventListener('click', openMenu);
      overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeMenu(); });
      overlay.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });

      // Focus trap
      const FOCUSABLE = 'a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])';
      overlay.addEventListener('keydown', (e)=>{
        if(e.key!=='Tab' || !overlay.classList.contains('open')) return;
        const nodes = Array.from(overlay.querySelectorAll(FOCUSABLE));
        if(!nodes.length) return;
        const first = nodes[0], last = nodes[nodes.length-1];
        if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
      });
      overlay.querySelector('.close-menu').addEventListener('click', closeMenu);
    })();

    // --- Calculator state & logic ---
    const msgEl = document.getElementById('message');
    const live = document.getElementById('liveRegion');
    const weightEl = document.getElementById('weight');
    const calcBtn = document.getElementById('calculate');
    const results = document.getElementById('results');
    let age = ''; let unit = '';
    function enableCalculator(enable){
      weightEl.disabled = !enable;
      document.querySelectorAll('#unitGroup .pill').forEach(b=> b.disabled = !enable);
      calcBtn.disabled = !enable;
    }
    initExclusiveGroup('ageGroup','age', (btn)=>{
      age = btn.dataset.age || '';
      msgEl.hidden = true; msgEl.textContent='';
      if(age==='0-2'){
        enableCalculator(false);
        msgEl.hidden = false;
        msgEl.textContent = 'If a child less than 60 days old has a fever it is a medical emergency. Please contact your pediatrician or seek care with a healthcare provider immediately.';
      }else{
        enableCalculator(true);
      }
    });
    initExclusiveGroup('unitGroup','unit', (btn)=>{ unit = btn.dataset.unit || ''; });
    function announce(msg){ live.textContent = msg; results.innerHTML = msg; }
    calcBtn.addEventListener('click', ()=>{
      const raw = (weightEl.value||'').trim();
      if(!age){ return announce('Please select an age group.'); }
      const val = parseFloat(raw);
      if(!raw || Number.isNaN(val) || val<=0){ return announce('Please enter a valid weight.'); }
      const u = unit || 'lbs';
      const kg  = u==='lbs' ? val/2.20462 : val;
      const lbs = u==='lbs' ? val         : val*2.20462;
      let html = `Patient weight: ${kg.toFixed(1)} kg (${lbs.toFixed(1)} lbs)<br/>`;
      if(age==='2-6'){
        const ACETA_MAX_INF=160;
        const acetaMgCalc = 12.5*kg;
        const acetaMg = Math.min(acetaMgCalc, ACETA_MAX_INF);
        const acetaMl = (acetaMg/160)*5;
        const capped = acetaMg<acetaMgCalc;
        html += `<strong>Acetaminophen (160 mg/5 mL)</strong><br/>
                 Give ${acetaMl.toFixed(1)} mL (${acetaMg.toFixed(0)} mg) every 4 hours as needed for fever/pain.<br/>
                 Maximum single dose for this age group is ${ACETA_MAX_INF} mg${capped?'; weight-based dose was limited to this maximum':''}.<br/>
                 Ibuprofen is not recommended under six months; consult your pediatrician.`;
      }else{
        const ACETA_MAX=1000, IBU_MAX=800;
        const acetaMgCalc=15*kg, acetaMg=Math.min(acetaMgCalc,ACETA_MAX), acetaMl=(acetaMg/160)*5, acetaCap=acetaMg<acetaMgCalc;
        const ibuMgCalc=10*kg,  ibuMg=Math.min(ibuMgCalc,IBU_MAX), ibuCap=ibuMg<ibuMgCalc;
        const ibuMl50=(ibuMg/50)*1.25, ibuMl100=(ibuMg/100)*5;
        html += `<strong>Acetaminophen (160 mg/5 mL)</strong><br/>
                 Give ${acetaMl.toFixed(1)} mL (${acetaMg.toFixed(0)} mg) every 6 hours as needed for fever/pain.<br/>
                 Maximum single dose is ${ACETA_MAX} mg${acetaCap?'; weight-based dose was limited to this maximum':''}.<br/>
                 <strong>Ibuprofen (Infant 50 mg/1.25 mL)</strong><br/>
                 Give ${ibuMl50.toFixed(1)} mL (${ibuMg.toFixed(0)} mg) every 6 hours as needed for fever/pain.<br/>
                 <strong>Ibuprofen (Children 100 mg/5 mL)</strong><br/>
                 Give ${ibuMl100.toFixed(1)} mL (${ibuMg.toFixed(0)} mg) every 6 hours as needed for fever/pain.<br/>
                 Maximum single dose is ${IBU_MAX} mg${ibuCap?'; weight-based dose was limited to this maximum':''}.<br/>
                 Never exceed ${ACETA_MAX} mg acetaminophen or ${IBU_MAX} mg ibuprofen per single dose.`;
      }
      results.innerHTML = html;
    });
    // Weight range announcements
    weightEl.addEventListener('change', ()=>{
      const u = unit || 'lbs';
      const v = parseFloat(weightEl.value);
      const minmax = u==='kg' ? [0.5,200] : [1,440];
      if(Number.isNaN(v)) return;
      if(v<minmax[0] || v>minmax[1]){
        announce(`Weight out of range. Enter between ${minmax[0]} and ${minmax[1]} ${u}.`);
      }else{
        live.textContent='';
      }
    });
  </script>
</body>
</html>